<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Programmation et Projet encadré</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body class="has-navbar-fixed-top">
		<!--NAVBAR-->
		<nav class="navbar is-light is-fixed-top">
			<div class="navbar-menu">
				<div class="navbar-start">
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-item" href="index.html#introduction">Introduction</a>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-item" href="index.html#analyse">Analyse</a>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-item" href="scripts.html">Scripts</a>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-item">Tableaux</a>
						<div class="navbar-dropdown">
							<a class="navbar-item" href="tableaux/tableau_fr.html">
							  Français
							</a>
							<a class="navbar-item" href="tableaux/tableau_ru.html">
							  Russe
							</a>
							<a class="navbar-item" href="tableaux/tableau_zh.html">
							  Chinois
							</a>
						  </div>
					</div>
				</div>
				<div class="navbar-end">
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-item" href="index.html#aPropos">À propos</a>
					</div>
					<div class="navbar-item">
						<a href="https://github.com/cbuontal/M1TAL_immigration"><img src="images/github_logo.png" alt="Github"></a>
					</div>
				</div>
			</div>
		</nav>
		<!--HEADER-->
		<header style="background-color: #06213e;">
			<img src="images/header.png" style="display: block; margin-left: auto; margin-right: auto; width: 50%;" alt="(IM|É)MIGRATION - Projet PPE">
		</header>
		<!--CONTENU-->
		<div class="has-text-justified", style="background-color: white;">
			<!--traitement des urls-->
			<h1 class="title has-text-centered" style="color: #a92927; font-size: 40px; letter-spacing: -0.02em; font-variant-caps: small-caps;">Traitement des URLs</h1>
			<div class="columns">
				<div class="column is-one-fifth"></div>
				<div class="column" style="border-left: 5px solid #a92927; overflow: auto; max-height: 1000px;">
					<p class="block">
						Ce programme nous permet de traiter toutes les urls d'un fichier afin de réaliser un tableau comportant les liens, des informations sur ceux-ci, les dumps des liens et les contextes et concordances. Il fait appel au script concordance.sh.
					</p>
					<pre>
						<code>
<span style="color: green;">#!/usr/bin/env bash

#===============================================================================
# VOUS DEVEZ MODIFIER CE BLOC DE COMMENTAIRES.
# Ici, on décrit le comportement du programme.
# Indiquez, entre autres, comment on lance le programme et quels sont
# les paramètres.
# La forme est indicative, sentez-vous libres d'en changer !
# Notamment pour quelque chose de plus léger, il n'y a pas de norme en bash.
#
#
#	Utilisation : bash traitement_url_base.sh nom_fichier_URL nom_fichier_HTML
#
#
#===============================================================================

# !!!!!!
# ici on doit vérifier que nos deux paramètres existent, sinon on ferme!
# !!!!!!</span>


<span style="color: blue;">if</span> [ <span style="color: orange;">$#</span> -ne <span style="color: red;">3</span> ]
<span style="color: blue;">then
	echo</span> <span style="color: gray;">"Il faut trois paramètres."</span>
	<span style="color: blue;">echo</span> <span style="color: gray;">"Utilisation : bash traitement_url_base.sh &lt;langue&gt; &lt;nom_fichier_URL&gt; &lt;nom_fichier_HTML&gt;"</span>
	<span style="color: blue;">exit
fi</span>

lang=<span style="color: orange;">$1</span>
fichier_urls=<span style="color: orange;">$2</span> <span style="color: green;"># le fichier d'URL en entrée</span>
fichier_tableau=<span style="color: orange;">$3</span> <span style="color: green;"># le fichier HTML en sortie</span>

basename=<span style="color: brown;">$(basename -s .txt $fichier_urls)</span>

<span style="color: blue;">if</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'zh'</span> ]]
<span style="color: blue;">then</span>
	mot=<span style="color: gray;">"移民"</span>
<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'ru'</span> ]]
<span style="color: blue;">then</span>
		mot=<span style="color: gray;">"(иммигр\w+|эмигр\w+)"</span>
<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'fr'</span> ]]
<span style="color: blue;">then</span>
	mot=<span style="color: gray;">"([Éé]migr\w+|[Ii]mmigr\w+)"</span>
<span style="color: blue;">fi</span>


<span style="color: green;"># on utilise la commande :
# curl -I lien.html
# pour obtenir seulement l'entête de la réponse du serveur
# -L pour gérer les réponses 301 "moved permanently"
# -s pour le mode silencieux et ne pas polluer l'affichage du terminal

# la réponse se trouve dans la première ligne du résultat, deuxième élément
# on peut l'obtenir en extrayant la première ligne et en sélectionnant son 2è élément


# curl -I nom_url | grep HTTP | cut -d ' ' -f 2</span>

<span style="color: blue;">echo</span> 	<span style="color: gray;">"&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset=\"utf-8\" /&gt;
		&lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css\"&gt;
		&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;
		&lt;title&gt;Tableau des URLS&lt;/title&gt;
	&lt;/head&gt;
	&lt;body class=\"has-navbar-fixed-top\"&gt;
		&lt;nav class=\"navbar is-light is-fixed-top\"&gt;&lt;div class=\"navbar-menu\"&gt;&lt;div class=\"navbar-start\"&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#introduction\"&gt;Introduction&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#analyse\"&gt;Analyse&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../scripts.html\"&gt;Scripts&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\"&gt;Tableaux&lt;/a&gt;&lt;div class=\"navbar-dropdown\"&gt;&lt;a class=\"navbar-item\" href=\"tableau_fr.html\"&gt;Français&lt;/a&gt;&lt;a class=\"navbar-item\" href=\"tableau_ru.html\"&gt;Russe&lt;/a&gt;&lt;a class=\"navbar-item\" href=\"tableau_zh.html\"&gt;Chinois&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=\"navbar-end\"&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#aPropos\"&gt;À propos&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item\"&gt;&lt;a href=\"https://github.com/cbuontal/M1TAL_immigration\"&gt;&lt;img src=\"../images/github_logo.png\" alt=\"Github\"&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/nav&gt;
		&lt;h1 class=\"title\"&gt;Tableau des URLs $basename&lt;/h1&gt;
		&lt;table class=\"table is-bordered\"&gt;
			&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ligne&lt;/th&gt;&lt;th&gt;code HTTP&lt;/th&gt;&lt;th&gt;URL&lt;/th&gt;&lt;th&gt;encodage&lt;/th&gt;&lt;th&gt;html&lt;/th&gt;&lt;th&gt;dump&lt;/th&gt;&lt;th&gt;occurrences&lt;/th&gt;&lt;th&gt;contextes&lt;/th&gt;&lt;th&gt;concordances&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;" &gt; "tableaux/$fichier_tableau"</span>


<span style="color: green;"># pour chaque URL du fichier URL :</span>

lineno=<span style="color: red;">1</span>;

<span style="color: blue;">if</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'zh'</span> ]]
<span style="color: blue;">then</span>

<span style="color: green;"># nécessaire pour le bon fonctionnement de `sed`</span>
lang_base=<span style="color: orange;">$LANG</span>
<span style="color: blue;">export</span> LANG=C

<span style="color: blue;">while read</span> -r URL;
<span style="color: blue;">do
	echo</span> -e <span style="color: gray;">"\tURL : $URL"</span>;

	<span style="color: green;"># réponse HTTP</span>
	code=<span style="color: brown;">$(curl -A "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0" -ILs $URL | grep -e "^HTTP/" | grep -Eo "[0-9]{3}" | tail -n 1)</span>
	<span style="color: green;"># récupération de l'encodage</span>
	charset=<span style="color: brown;">$(curl -A "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0" -Ls $URL -D - -o "./aspirations/fich-$lineno.html" | grep -Eo "charset=(\w|-)+" | cut -d= -f2)</span>

	<span style="color: blue;">if</span> [[ <span style="color: blue;">-z</span> <span style="color: orange;">$charset</span> ]]
	<span style="color: blue;">then
		echo</span> -e <span style="color: gray;">"\tencodage non détecté, on prendra UTF-8 par défaut."</span>;
		charset=<span style="color: gray;">"UTF-8"</span>;
	<span style="color: blue;">else
		echo</span> -e <span style="color: gray;">"\tencodage : $charset"</span>;
	<span style="color: blue;">fi</span>
	<span style="color: green;"># pour transformer les 'utf-8' en 'UTF-8' :</span>
	charset=<span style="color: brown;">$(echo $charset | tr "[a-z]" "[A-Z]")</span>

	<span style="color: green;"># cette page pose problème...</span>
	<span style="color: blue;">if</span> [[ <span style="color: orange;">$URL</span> == <span style="color: gray;">"https://www.cnr.cn/sx/yw/20221129/t20221129_526078646.shtml"</span> ]]
	<span style="color: blue;">then</span>
		charset=<span style="color: gray;">"gb2312"</span>
	<span style="color: ;">fi

	if</span> [[ <span style="color: orange;">$code</span> -eq <span style="color: red;">200</span> ]]
	<span style="color: blue;">then</span>
		aspiration=<span style="color: brown;">$(curl -A "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0" $URL)</span>

		<span style="color: blue;">if</span> [[ <span style="color: orange;">$charset</span> == <span style="color: gray;">'UTF-8'</span> ]]
		<span style="color: blue;">then</span>
			dump=<span style="color: brown;">$(curl $URL | iconv -f UTF-8 -t UTF-8//IGNORE | lynx -stdin -dump -assume_charset=utf-8 -display_charset=utf-8 | sed -E "/(BUTTON)/d" | sed -E "/   [*+#_©×]/d" | sed -E "/   \[/d" | sed -E "/^IFRAME/d")</span>
		<span style="color: blue;">else</span>
			<span style="color: green;"># charset=$(curl $URL | urchardet)</span>
			dump=<span style="color: brown;">$(curl $URL | iconv -f $charset -t UTF-8//IGNORE | lynx -stdin -dump -assume_charset=utf-8 -display_charset=utf-8 | sed -E "/(BUTTON)/d" | sed -E "/   [*+#_©×]/d" | sed -E "/   \[/d" | sed -E "/^IFRAME/d")</span>
		<span style="color: blue;">fi
	else
		echo</span> -e <span style="color: gray;">"\tcode différent de 200 utilisation d'un dump vide"</span>
		dump=<span style="color: gray;">""</span>
		charset=<span style="color: gray;">""</span>
	<span style="color: blue;">fi

	echo</span> <span style="color: gray;">"$aspiration"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./aspirations/$basename-$lineno.html"</span>

	<span style="color: blue;">echo</span> <span style="color: gray;">"$dump"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./dumps-text/$basename-$lineno.txt"</span>
	<span style="color: green;"># segmentation du dump avec thulac, on supprime aussi les indications du scripts qui polluent le dump :</span>
	dumpseg=<span style="color: brown;">$(python3 scripts/tokenize_chinese.py "./dumps-text/$basename-$lineno.txt" | sed -E "/Model loaded succeed/d" | sed -E '/References/,$d')</span>
	<span style="color: green;"># on écrase le dump non segmenté</span>
	<span style="color: blue;">echo</span> <span style="color: gray;">"$dumpseg"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./dumps-text/$basename-$lineno.txt"</span>

	<span style="color: green;"># compte du nombre d'occurrences</span>
	NB_OCC=<span style="color: brown;">$(grep -a -E -o $mot ./dumps-text/$basename-$lineno.txt | wc -l)</span>

	<span style="color: green;"># extraction des contextes</span>
	<span style="color: blue;">grep</span> -E -A1 -B1 <span style="color: orange;">$mot</span> ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: brown;">&gt;</span> ./contextes/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt

	<span style="color: green;"># construction des concordances avec une commande externe</span>
	<span style="color: blue;">bash</span> scripts/concordance.sh zh ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: orange;">$mot</span> <span style="color: brown;">&gt;</span> ./concordances/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html


	<span style="color: blue;">echo</span> <span style="color: gray;">"			&lt;tr&gt;&lt;td&gt;$lineno&lt;/td&gt;&lt;td&gt;$code&lt;/td&gt;&lt;td&gt;&lt;a href=\"$URL\"&gt;$URL&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$charset&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../aspirations/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;html&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;text&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$NB_OCC&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../contextes/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;contextes&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../concordances/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;concordance&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span> <span style="color: brown;">&gt;&gt;</span> <span style="color: gray;">"tableaux/$fichier_tableau"</span>
	lineno=$((lineno+1));
<span style="color: blue;">done</span> <span style="color: brown;">&lt;</span> <span style="color: orange;">$fichier_urls</span>

<span style="color: green;"># on revient à la variable globale de base une fois le traitement terminé</span>
<span style="color: blue;">export</span> LANG=lang_base

<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'ru'</span> ]]
<span style="color: blue;">then
while read</span> -r URL;
<span style="color: blue;">do
			echo</span> -e <span style="color: gray;">"\tURL : $URL"</span>;
			code=<span style="color: brown;">$(curl -ILs $URL | grep -e "^HTTP/" | grep -Eo "[0-9]{3}" | tail -n 1)</span> <span style="color: green;"># de la manière attendue, sans l'option -w de cURL</span>
			charset=<span style="color: brown;">$(curl -ILs $URL | grep -Eo "charset=(\w|-)+" | cut -d= -f2)</span>
			charset=<span style="color: brown;">$(echo $charset | tr "[a-z]" "[A-Z]")</span> <span style="color: green;">#ici nous définissons pour la valeur sharset la commande "convertir toutes les petites lettres en majuscules, afin que toutes les lettres UTF-8 soient du même type</span>
			<span style="color: blue;">echo</span> -e <span style="color: gray;">"\tcode : $code"</span>;

			<span style="color: blue;">if</span> [[ <span style="color: blue;">-z</span> <span style="color: orange;">$charset</span> ]]
			<span style="color: blue;">then
						echo</span> -e <span style="color: gray;">"\tencodage non détecté, on prendra UTF-8 par défaut."</span>;
						charset=<span style="color: gray;">"UTF-8"</span>;
			<span style="color: blue;">else
						echo</span> -e <span style="color: gray;">"\tencodage : $charset"</span>;
			<span style="color: blue;">fi

			if</span> [[  <span style="color: orange;">$code</span> -eq <span style="color: red;">200</span> || <span style="color: orange;">$code</span> -eq <span style="color: red;">403</span> ]]
						<span style="color: blue;">then</span>
						aspiration=<span style="color: brown;">$(curl $URL)</span>
						dump=<span style="color: brown;">$(lynx -dump -nolist -accept_all_cookies -assume_charset=$charset -display_charset=$charset $URL)</span>
						<span style="color: blue;">if</span> [[  <span style="color: orange;">$charset</span> -ne <span style="color: gray;">'UTF-8'</span> ]]
						<span style="color: blue;">then</span>
							dump=<span style="color: brown;">$(iconv -f $charset -t UTF-8)</span>
						<span style="color: blue;">fi
			else
						echo</span> -e <span style="color: gray;">"\tcode différent de 200 utilisation d'un dump vide"</span>
						dump=<span style="color: gray;">""</span>
						charset=<span style="color: gray;">""</span>
			<span style="color: blue;">fi

			echo</span> <span style="color: gray;">"$dump"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./dumps-text/$basename-$lineno.txt"</span>
			<span style="color: blue;">echo</span> <span style="color: gray;">"$aspiration"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./aspirations/$basename-$lineno.html"</span>

<span style="color: green;"># compte du nombre d'occurrences</span>
NB_OCC=<span style="color: brown;">$(grep -E -o $mot ./dumps-text/$basename-$lineno.txt | wc -l)</span>
	<span style="color: green;"># extraction des contextes</span>
<span style="color: blue;">grep</span> -E -A2 -B2 <span style="color: orange;">$mot</span> ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: brown;">&gt;</span> <span style="color: gray;">"./contextes/$basename-$lineno.txt"</span> <span style="color: green;">#хз почему но тут и дальше я указал в скобках путь к файлам
	# construction des concordance avec une commande externe</span>
<span style="color: blue;">bash</span> scripts/concordance.sh ru ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: orange;">$mot</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./concordances/$basename-$lineno.html"</span>

<span style="color: blue;">echo</span> <span style="color: gray;">"&lt;tr&gt;&lt;td&gt;$lineno&lt;/td&gt;&lt;td&gt;$code&lt;/td&gt;&lt;td&gt;&lt;a href=\"$URL\"&gt;$URL&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$charset&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../aspirations/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;html&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;text&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$NB_OCC&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../contextes/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;contextes&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../concordances/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;concordance&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span> <span style="color: brown;">&gt;&gt;</span> <span style="color: gray;">"tableaux/$fichier_tableau"</span> <span style="color: green;">#Nous spécifions ici où placer toutes les informations et notons qu'il n'est pas nécessaire de les supprimer à chaque itération</span>
<span style="color: blue;">echo</span> -e <span style="color: gray;">"\t--------------------------------"</span>

lineno=$((lineno+1));

<span style="color: blue;">done</span>  <span style="color: brown;">&lt;</span> <span style="color: orange;">$fichier_urls</span>

<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'fr'</span> ]]
<span style="color: blue;">then
while read</span> -r URL;
<span style="color: blue;">do
			echo</span> -e <span style="color: gray;">"\tURL : $URL"</span>;
			code=<span style="color: brown;">$(curl -ILs $URL | grep -e "^HTTP/" | grep -Eo "[0-9]{3}" | tail -n 1)</span> <span style="color: green;"># de la manière attendue, sans l'option -w de cURL</span>
			charset=<span style="color: brown;">$(curl -ILs $URL | grep -Eo "charset=(\w|-)+" | cut -d= -f2)</span>
			charset=<span style="color: brown;">$(echo $charset | tr "[a-z]" "[A-Z]")</span> <span style="color: green;">#ici nous définissons pour la valeur sharset la commande "convertir toutes les petites lettres en majuscules, afin que toutes les lettres UTF-8 soient du même type</span>
			<span style="color: blue;">echo</span> -e <span style="color: gray;">"\tcode : $code"</span>;

			<span style="color: blue;">if</span> [[ <span style="color: blue;">-z</span> <span style="color: orange;">$charset</span> ]]
			<span style="color: blue;">then
						echo</span> -e <span style="color: gray;">"\tencodage non détecté, on prendra UTF-8 par défaut."</span>;
						charset=<span style="color: gray;">"UTF-8"</span>;
			<span style="color: blue;">else
						echo</span> -e <span style="color: gray;">"\tencodage : $charset"</span>;
			<span style="color: blue;">fi

			if</span> [[  <span style="color: orange;">$code</span> -eq <span style="color: red;">200</span> || <span style="color: orange;">$code</span> -eq <span style="color: red;">403</span> ]]
				<span style="color: blue;">then</span>
						aspiration=<span style="color: brown;">$(curl $URL)</span>
						dump=<span style="color: brown;">$(lynx -dump -nolist -accept_all_cookies -assume_charset=$charset -display_charset=$charset $URL)</span>
						<span style="color: blue;">if</span> [[  <span style="color: orange;">$charset</span> -ne <span style="color: gray;">'UTF-8'</span> ]]
						<span style="color: blue;">then</span>
							dump=<span style="color: brown;">$(iconv -f $charset -t UTF-8)</span>
						<span style="color: blue;">fi
			else
						echo</span> -e <span style="color: gray;">"\tcode différent de 200 utilisation d'un dump vide"</span>
						dump=<span style="color: gray;">""</span>
						charset=<span style="color: gray;">""</span>
			<span style="color: blue;">fi

			echo</span> <span style="color: gray;">"$dump"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./dumps-text/$basename-$lineno.txt"</span>
			<span style="color: green;"># une fois le fichier créé, on peut utiliser la commande suivante pour supprimer les espaces en début de ligne :</span>
			LANG=C sed -i.bak <span style="color: gray;">'s/^[[:space:]]*//' "./dumps-text/$basename-$lineno.txt"</span>
			<span style="color: green;"># une fois les espaces de début de ligne supprimés, on peut nettoyer</span>
			dump_propre=<span style="color: brown;">$(cat "./dumps-text/$basename-$lineno.txt" | LANG=C sed '/Également sur RFI/,$d' | LANG=C sed '/(BUTTON)/d' | LANG=C sed '/^[+*©►]/d' | LANG=C sed '/^Price:/,$d' | LANG=C sed '/^http/d' | LANG=C sed '/^IFRAME/d' )</span>
			<span style="color: green;"># et on remplace le dump initial par le dump nettoyé</span>
			echo <span style="color: gray;">"$dump_propre"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./dumps-text/$basename-$lineno.txt"</span>

			<span style="color: blue;">echo</span> <span style="color: gray;">"$aspiration"</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./aspirations/$basename-$lineno.html"</span>

<span style="color: green;"># compte du nombre d'occurrences</span>
NB_OCC=<span style="color: brown;">$(grep -E -o $mot ./dumps-text/$basename-$lineno.txt | wc -l)</span>
	<span style="color: green;"># extraction des contextes</span>
<span style="color: blue;">grep</span> -E -A2 -B2 <span style="color: orange;">$mot</span> ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: brown;">&gt;</span> <span style="color: gray;">"./contextes/$basename-$lineno.txt"</span>
	<span style="color: green;"># construction des concordance avec une commande externe</span>
<span style="color: blue;">bash</span> scripts/concordance.sh fr ./dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt <span style="color: orange;">$mot</span> <span style="color: brown;">&gt;</span> <span style="color: gray;">"./concordances/$basename-$lineno.html"</span>

<span style="color: blue;">echo</span> <span style="color: gray;">"&lt;tr&gt;&lt;td&gt;$lineno&lt;/td&gt;&lt;td&gt;$code&lt;/td&gt;&lt;td&gt;&lt;a href=\"$URL\"&gt;$URL&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$charset&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../aspirations/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;html&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../dumps-text/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;text&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$NB_OCC&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../contextes/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.txt<span style="color: gray;">"&gt;contextes&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="</span>../concordances/<span style="color: orange;">$basename</span>-<span style="color: orange;">$lineno</span>.html<span style="color: gray;">"&gt;concordance&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span> <span style="color: brown;">&gt;&gt;</span> <span style="color: gray;">"tableaux/$fichier_tableau"</span> <span style="color: green;">#Nous spécifions ici où placer toutes les informations et notons qu'il n'est pas nécessaire de les supprimer à chaque itération</span>
<span style="color: blue;">echo</span> -e <span style="color: gray;">"\t--------------------------------"</span>

lineno=$((lineno+1));

<span style="color: blue;">done</span>  <span style="color: brown;">&lt;</span> <span style="color: orange;">$fichier_urls</span>

<span style="color: ;blue">fi</span>


<span style="color: green;">#on ferme le fichier</span>
<span style="color: blue;">echo</span> <span style="color: gray;">"		&lt;/table&gt;
	&lt;/body&gt;
&lt;/html&gt;"</span> <span style="color: brown;">&gt;&gt;</span> <span style="color: gray;">"tableaux/$fichier_tableau"</span>
						</code>
					</pre>
				</div>
				<div class="column is-one-fifth"></div>
			</div>
			<!--concordances-->
			<h1 class="title has-text-centered" style="color: #a92927; font-size: 40px; letter-spacing: -0.02em; font-variant-caps: small-caps;">Concordances</h1>
			<div class="columns">
				<div class="column is-one-fifth"></div>
				<div class="column" style="border-left: 5px solid #a92927; overflow: auto; max-height: 1000px;">
					<p class="block">
						Ce programme nous permet de générer les tableaux de concordances.
					</p>
					<pre>
						<code>
<span style="color: green;">#!/usr/bin/env bash

#
#		Script qui établit une table de concordance en HTML autour d'un motif
#		usage : bash concordance.sh &lt;fichier&gt; &lt;motif&gt;
#
#</span>

lang=<span style="color: orange;">$1</span> <span style="color: green;"># fr, ru, zh</span>
fichier_text=<span style="color: orange;">$2</span>
motif=<span style="color: orange;">$3</span>

<span style="color: blue;">if</span> [[ <span style="color: orange;">$#</span> -ne <span style="color: red;">3</span> ]]
<span style="color: blue;">then
	echo</span> <span style="color: gray;">"Ce programme demande exactement trois arguments."</span>
	<span style="color: blue;">echo</span> <span style="color: gray;">"Usage : $0 &lt;langue&gt; &lt;fichier&gt; &lt;motif&gt;"</span>
	<span style="color: blue;">exit
fi

if</span> [[ ! <span style="color: blue;">-f</span> <span style="color: orange;">$fichier_text</span> ]]
<span style="color: blue;">then
	echo</span> <span style="color: gray;">"le fichier $fichier_text n'existe pas"</span>
	<span style="color: blue;">exit
fi

if</span> [[ <span style="color: blue;">-z</span> <span style="color: orange;">$motif</span> ]]
<span style="color: blue;">then
	echo</span> <span style="color: gray;">"le motif est vide"</span>
	<span style="color: blue;">exit
fi

if</span> [[ <span style="color: orange;">$lang</span> != <span style="color: gray;">'fr'</span> && <span style="color: orange;">$lang</span> != <span style="color: gray;">'ru'</span> && <span style="color: orange;">$lang</span> != <span style="color: gray;">'zh'</span> ]]
<span style="color: blue;">then
	echo</span> <span style="color: gray;">"C'est quoi cette langue ?"</span>
	<span style="color: blue;">exit
fi

echo</span> 	<span style="color: gray;">"
			&lt;html&gt;
				&lt;html lang=\"$lang\"&gt;
				&lt;head&gt;
							&lt;meta charset=\"utf-8\" /&gt;
							&lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css\"&gt;
							&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;
							&lt;title&gt;Concordance&lt;/title&gt;
			&lt;/head&gt;
			&lt;body class=\"has-navbar-fixed-top\"&gt;
							&lt;nav class=\"navbar is-light is-fixed-top\"&gt;&lt;div class=\"navbar-menu\"&gt;&lt;div class=\"navbar-start\"&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#introduction\"&gt;Introduction&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#analyse\"&gt;Analyse&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../scripts.html\"&gt;Scripts&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\"&gt;Tableaux&lt;/a&gt;&lt;div class=\"navbar-dropdown\"&gt;&lt;a class=\"navbar-item\" href=\"../tableaux/tableau_fr.html\"&gt;Français&lt;/a&gt;&lt;a class=\"navbar-item\" href=\"../tableaux/tableau_ru.html\"&gt;Russe&lt;/a&gt;&lt;a class=\"navbar-item\" href=\"../tableaux/tableau_zh.html\"&gt;Chinois&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=\"navbar-end\"&gt;&lt;div class=\"navbar-item has-dropdown is-hoverable\"&gt;&lt;a class=\"navbar-item\" href=\"../index.html#aPropos\"&gt;À propos&lt;/a&gt;&lt;/div&gt;&lt;div class=\"navbar-item\"&gt;&lt;a href=\"https://github.com/cbuontal/M1TAL_immigration\"&gt;&lt;img src=\"../images/github_logo.png\" alt=\"Github\"&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/nav&gt;
							&lt;h1 class=\"title\"&gt;Concordance&lt;/h1&gt;
							&lt;table class=\"table is-bordered is-striped is-narrow is-hoverable is-fullwidth\"&gt;
									&lt;thead&gt;
									&lt;tr&gt;
									&lt;th class=\"has-text-right\"&gt;Contexte gauche&lt;/th&gt;
									&lt;th&gt;Cible&lt;/th&gt;
									&lt;th class=\"has-text-left\"&gt;Contexte droit&lt;/th&gt;
									&lt;/tr&gt;
									&lt;/thead&gt;
									"</span>

<span style="color: blue;">if</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'fr'</span> ]]
<span style="color: blue;">then
	grep</span> -E -o -i <span style="color: gray;">"(\w+\W+| {0,5})$motif\b(\W+\w+| ){0,5}"</span> <span style="color: orange;">$fichier_text</span> | <span style="color: blue;">sed</span> -E -r <span style="color: gray;">"s/(.*)$motif(.*)/&lt;tr&gt;&lt;td class=\"has-text-right\"&gt;\1&lt;\/td&gt;&lt;td class=\"has-text-danger\"&gt;\2&lt;\/td&gt;&lt;td class=\"has-text-left\"&gt;\3&lt;\/td&gt;&lt;\/tr&gt;/I"</span>
<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'ru'</span> ]]
<span style="color: blue;">then</span>
	<span style="color: green;">#pour utiliser cette ligne, il faut installer gnu-sed : brew install gnu-sed. sinon utiliser "sed"</span>
	<span style="color: blue;">grep</span> -E -o -i <span style="color: gray;">"(\w+\W+){0,5}\b$motif\b(\W+\w+){0,5}"</span> <span style="color: orange;">$fichier_text</span> | <span style="color: blue;">sed</span> -E <span style="color: gray;">"s/(.*)$motif(.*)/&lt;tr&gt;&lt;td class=\"has-text-right\"&gt;\1&lt;\/td&gt;&lt;td class=\"has-text-danger\"&gt;\2&lt;\/td&gt;&lt;td class=\"has-text-left\"&gt;\3&lt;\/td&gt;&lt;\/tr&gt;/I"</span>
<span style="color: blue;">elif</span> [[ <span style="color: orange;">$lang</span> == <span style="color: gray;">'zh'</span> ]]
<span style="color: blue;">then</span>
	LANG=zh_CN.UTF-8 grep -Po <span style="color: gray;">"((\p{Han}|，){1,5} ){0,5}$motif( (\p{Han}|，){1,5}){0,5}"</span> <span style="color: orange;">$fichier_text</span> | LANG=C sed -E <span style="color: gray;">"s/(.*)($motif)(.*)/&lt;tr&gt;&lt;td class=\"has-text-right\"&gt;\1&lt;\/td&gt;&lt;td class=\"has-text-danger\"&gt;\2&lt;\/td&gt;&lt;td class=\"has-text-left\"&gt;\3&lt;\/td&gt;&lt;\/tr&gt;/"</span>
<span style="color: blue;">fi

echo</span> <span style="color: gray;">"
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
"</span>
						</code>
					</pre>
				</div>
				<div class="column is-one-fifth"></div>
			</div>
			<!--tokenisation chinois-->
			<h1 class="title has-text-centered" style="color: #a92927; font-size: 40px; letter-spacing: -0.02em; font-variant-caps: small-caps;">Tokenisation du chinois</h1>
			<div class="columns">
				<div class="column is-one-fifth"></div>
				<div class="column" style="border-left: 5px solid #a92927; overflow: auto; max-height: 1000px;">
					<p class="block">
						Ce programme nous permet de tokeniser (mettre des espaces entre les mots) les fichiers en chinois afin de pouvoir les traiter par la suite.
					</p>
					<pre>
						<code>
<span style="color: green;">#!/usr/bin/env python3</span>

<span style="color: blue;">import</span> thulac
<span style="color: blue;">import</span> errno
<span style="color: blue;">import</span> fileinput

<span style="color: green;"># utilisation : python3 tokenize_chinese.py chinois.txt
# possibilité de rediriger la sortie avec >, >>

# autre possibilité, lancer la commande:
# python3 -m thulac chinois.txt chinois_seg_output.txt -seg_only
# Mais ne permet pas les redirections d'entrées/sorties</span>

seg = thulac.thulac(seg_only=<span style="color: blue;">True</span>)
<span style="color: blue;">try</span>:
	<span style="color: blue;">for</span> line <span style="color: blue;">in</span> fileinput.input():
		<span style="color: blue;">print</span>(seg.cut(line, text=<span style="color: blue;">True</span>))
<span style="color: blue;">except</span> IOError <span style="color: blue;">as</span> e:
	<span style="color: blue;">if</span> e.errno != errno.EPIPE:
		<span style="color: blue;">raise</span>							
						</code>
					</pre>
				</div>
				<div class="column is-one-fifth"></div>
			</div>
			<!--nuages de mots-->
			<h1 class="title has-text-centered" style="color: #a92927; font-size: 40px; letter-spacing: -0.02em; font-variant-caps: small-caps;">Nuages de mots</h1>
			<div class="columns">
				<div class="column is-one-fifth"></div>
				<div class="column" style="border-left: 5px solid #a92927; overflow: auto; max-height: 1000px;">
					<!--ru fr-->
					<h2 class="title has-text-centered" style="color: #06213e; font-size: 32px; letter-spacing: -0.02em;">Russe et français</h2>
					<p class="block">
						Ce programme nous permet de générer des nuages de mots pour le russe et le français. Ici, l'exemple est donné pour le russe. Un autre fichier est disponible adapté au français.
					</p>
					<pre>
						<code>
<span style="color: blue;">import</span> string
<span style="color: blue;">import</span> re
<span style="color: blue;">import</span> matplotlib.pyplot <span style="color: blue;">as</span> plt
<span style="color: blue;">import</span> nltk
<span style="color: blue;">from</span> nltk.corpus <span style="color: blue;">import</span> stopwords
<span style="color: blue;">from</span> nltk <span style="color: blue;">import</span> word_tokenize
<span style="color: blue;">from</span> wordcloud <span style="color: blue;">import</span> WordCloud

<span style="color: green;">## À EXÉCUTER DEPUIS LA RACINE DU DOSSIER</span>

text = str()
<span style="color: blue;">with</span> open(<span style="color: gray;">"./dumps-text/ru_total2.txt"</span>, <span style="color: gray;">"r"</span>) <span style="color: blue;">as</span> f:
	text = f.read()

<span style="color: green;"># passage en minuscule et suppression des ponctuations et lignes vides</span>
text = text.lower()
spec_chars = string.punctuation + <span style="color: gray;">'\n\xa0«»\t—…'</span>
text = re.sub(<span style="color: gray;">'\n'</span>, <span style="color: gray;">''</span>, text)
text = <span style="color: gray;">""</span>.join([ch <span style="color: blue;">for</span> ch <span style="color: blue;">in</span> text <span style="color: blue;">if</span> ch <span style="color: blue;">not in</span> spec_chars])
<span style="color: green;"># suppression des mots contenant des caractères latins</span>
mots_texte = text.split()
<span style="color: blue;">for</span> idx, mot <span style="color: blue;">in</span> enumerate(mots_texte):
	<span style="color: blue;">if</span> <span style="color: gray;">'a'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'b'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'c'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'d'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'e'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'f'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'g'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'h'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'i'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'j'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'k'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'l'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'m'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'n'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'o'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'p'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'q'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'r'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'s'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'t'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'u'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'v'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'w'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'x'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'y'</span> <span style="color: blue;">in</span> mot <span style="color: blue;">or</span> <span style="color: gray;">'z'</span> <span style="color: blue;">in</span> mot :
		mots_texte.remove(mot)
text = <span style="color: gray;">" "</span>.join(mots_texte)

text_tokens = word_tokenize(text)
text = nltk.Text(text_tokens)

russian_stopwords = stopwords.words(<span style="color: gray;">"russian"</span>)
<span style="color: green;">#liste de mots indésirables</span>
russian_stopwords.extend([<span style="color: gray;">'это'</span>, <span style="color: gray;">'iframe'</span>, <span style="color: gray;">'году'</span>, <span style="color: gray;">'нею'</span>, <span style="color: gray;">'button'</span>, <span style="color: gray;">'twitter'</span>, <span style="color: gray;">'telegram'</span>, <span style="color: gray;">'livejournal'</span>, <span style="color: gray;">'года'</span>, <span style="color: gray;">'который'</span>, <span style="color: gray;">'изза'</span>])

text_tokens = [token.strip() <span style="color: blue;">for</span> token <span style="color: blue;">in</span> text_tokens <span style="color: blue;">if</span> token <span style="color: blue;">not in</span> russian_stopwords]
text = nltk.Text(text_tokens)

<span style="color: green;">## création du nuage de mots</span>
text_raw = <span style="color: gray;">" "</span>.join(text)
wordcloud = WordCloud(max_font_size=<span style="color: red;">50</span>, max_words=<span style="color: red;">100</span>, background_color=<span style="color: gray;">"white"</span>).generate(text_raw)
plt.imshow(wordcloud, interpolation=<span style="color: gray;">'bilinear'</span>)
plt.axis(<span style="color: gray;">"off"</span>)
plt.show()
						</code>
					</pre>
					<!--zh-->
					<h2 class="title has-text-centered" style="color: #06213e; font-size: 32px; letter-spacing: -0.02em;">Chinois</h2>
					<p class="block">
						Ce programme nous permet de générer des nuages de mots pour le chinois.
					</p>
					<pre>
						<code>
<span style="color: blue;">import</span> jieba, codecs, sys, pandas
<span style="color: blue;">import</span> numpy <span style="color: blue;">as</span> np
<span style="color: blue;">from</span> wordcloud <span style="color: blue;">import</span> WordCloud
<span style="color: blue;">from</span> imageio <span style="color: blue;">import</span> imread
<span style="color: blue;">from</span> wordcloud <span style="color: blue;">import</span> WordCloud, ImageColorGenerator
<span style="color: blue;">from</span> os <span style="color: blue;">import</span> listdir
<span style="color: blue;">from</span> os.path <span style="color: blue;">import</span> isfile, join
<span style="color: blue;">import</span> matplotlib.pyplot <span style="color: blue;">as</span> plt

<span style="color: green;">#
#   Pour bien fonctionner, ce script a besoin de deux fichiers :
#       - un fichier .txt contenant les stopwords chinois
#       - un fichier .ttf contenant la police à utiliser
#
#   Ces fichiers sont rangés dans un sous-dossier data/
#
#</span>



stopwords_filename = <span style="color: gray;">'data/stopwords_zh.txt'</span>
font_filename = <span style="color: gray;">'data/simkai.ttf'</span>

<span style="color: blue;">def</span> <span style="color: magenta;">contain_latin</span>(txt):
	<span style="color: blue;">return</span> (<span style="color: gray;">'a'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'b'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'c'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'d'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'e'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'f'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'g'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'h'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'i'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'j'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'k'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'l'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'m'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'n'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'o'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'p'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'q'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'r'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'s'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'t'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'u'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'v'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'w'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'x'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'y'</span> <span style="color: blue;">in</span> txt <span style="color: blue;">or</span> <span style="color: gray;">'z'</span> <span style="color: blue;">in</span> txt)

<span style="color: blue;">def</span> <span style="color: magenta;">filter_numbers</span>(txt):
	<span style="color: green;">"""
		Renvoie vrai si l'argument passé en paramètre est une chaîne de caractères
		constituée uniquement de chiffres et de longueur strictement supérieure à 4
		- renvoie False si la chaîne est une suite de chiffres de longueur &gt; 4
		- True sinon

		But = ne garder que les nombres assimilables à des années, ou éventuellement
		des pourcentages
	"""</span>
	<span style="color: blue;">if</span> txt.isdigit() <span style="color: blue;">and</span> len(txt) <span style="color: blue;">&gt;</span> <span style="color: red;">4</span>:
		<span style="color: blue;">return False
	else</span>:
		<span style="color: blue;">return True

def</span> <span style="color: magenta;">main</span>(input_filename):
	content = <span style="color: gray;">'\n'</span>.join([line.strip()
						<span style="color: blue;">for</span> line <span style="color: blue;">in</span> codecs.open(input_filename, <span style="color: gray;">'r'</span>, <span style="color: gray;">'utf-8'</span>)
						<span style="color: blue;">if</span> len(line.strip()) <span style="color: blue;">&gt;</span> <span style="color: red;">0</span>])
	stopwords = set([line.strip()
					<span style="color: blue;">for</span> line <span style="color: blue;">in</span> codecs.open(stopwords_filename, <span style="color: gray;">'r'</span>, <span style="color: gray;">'utf-8'</span>)])

	segs = jieba.cut(content)
	words = []
	<span style="color: blue;">for</span> seg <span style="color: blue;">in</span> segs:
		word = seg.strip().lower()
		<span style="color: green;"># nettoyage des mots indésirables</span>
		<span style="color: blue;">if</span> len(word) <span style="color: blue;">&gt;</span> <span style="color: red;">1</span> <span style="color: blue;">and</span> word <span style="color: blue;">not in</span> stopwords <span style="color: blue;">and not</span> contain_latin(word) <span style="color: blue;">and</span> filter_numbers(word) <span style="color: blue;">and</span> word != <span style="color: gray;">'-%'</span>:
			words.append(word)

	words_df = pandas.DataFrame({<span style="color: gray;">'word'</span>:words})
	words_stat = words_df.groupby(by=[<span style="color: gray;">'word'</span>])[<span style="color: gray;">'word'</span>].agg(number=np.size)
	words_stat = words_stat.reset_index().sort_values(by=<span style="color: gray;">"number"</span>,ascending=<span style="color: blue;">False</span>)

	<span style="color: blue;">print</span>(<span style="color: gray;">'# of different words ='</span>, len(words_stat))

	wordcloud = WordCloud(font_path=font_filename, max_font_size=<span style="color: red;">50</span>, random_state=<span style="color: red;">100</span>, max_words=<span style="color: red;">100</span>, background_color=<span style="color: gray;">"white"</span>)
	wordcloud = wordcloud.fit_words(dict(words_stat.head(<span style="color: red;">4000</span>).itertuples(index=<span style="color: blue;">False</span>)))
	<span style="color: blue;">print</span>(<span style="color: gray;">"Sauvegarde du nuage"</span>)
	wordcloud.to_file(<span style="color: gray;">'nuage_chinois.png'</span>)

<span style="color: blue;">if</span> __name__ <span style="color: blue;">==</span> <span style="color: gray;">'__main__'</span>:
	<span style="color: blue;">if</span> len(sys.argv) <span style="color: blue;">==</Span> <span style="color: red;">2</span>:
		main(sys.argv[<span style="color: red;">1</span>])
	<span style="color: blue;">else</span>:
		<span style="color: blue;">print</span>(<span style="color: gray;">'[usage] &lt;input&gt;'</span>)														
						</code>
					</pre>
				</div>
				<div class="column is-one-fifth"></div>
			</div>
    	</div>
	</body>
</html>